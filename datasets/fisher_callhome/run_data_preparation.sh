#!/bin/bash

# Script to train prepare the datasets for the multi-task ST

# data,
ORIGINAL_DATA="/folder/to/datasets/fisher_callhome_spanish/"
data_output=data

# first, prepare the data:
python3 st_asr_task/data_prep.py $ORIGINAL_DATA $data_output

# create training set with ASR + ST tags, we concatenate the files
# we then fix the JSON file

# TODO: to fix the last line generated by JSON file:
# only only-callhome dataset, ASR+ST
jq -s 'add' ${data_output}/callhome-train/data{-asr,-st}.json \
    > ${data_output}/callhome-train/data-asr-st.json

# only fisher-callhome dataset, ASR+ST
jq -s 'add' ${data_output}/train/data{-asr,-st}.json \
    > ${data_output}/train/data-asr-st.json

mkdir -p ${data_output}/fisher-callhome-train
# both datasets, only ASR
jq -s 'add' ${data_output}/{train,callhome-train}/data-asr.json \
    > ${data_output}/fisher-callhome-train/data-asr.json

# both datasets, only ST
jq -s 'add' ${data_output}/{train,callhome-train}/data-st.json \
    > ${data_output}/fisher-callhome-train/data-st.json

# both datasets, ASR+ST
jq -s 'add' ${data_output}/{train,callhome-train}/data{-asr,-st}.json \
    > ${data_output}/fisher-callhome-train/data-asr-st.json

# prepare the DEV dataset for reporting during training
jq -s 'add' ${data_output}/dev/data{-asr,-st}.json \
    > ${data_output}/dev/data-asr-st.json

echo Done preparing the train, dev and test datasets FISHER-CALLHOME
exit 1
